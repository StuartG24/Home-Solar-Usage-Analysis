---
title: "Energy Usage Analysis"
subtitle: "An Analysis of Solar Generation Effectiveness"
author: "Student Number: 2710017"
date: "9 November 2024"
output:
  pdf_document: default
  html_document: default
links-as-notes: true
header-includes:
  \usepackage{lastpage}
  \usepackage{fancyhdr}
  \pagestyle{fancy}
  \fancyhead[L]{Energy Usage Analysis}
  \fancyhead[C]{}
  \fancyhead[R]{\thepage\ of \pageref{LastPage}}
  \fancyfoot[C]{}
bibliography: references.bib
csl: "harvard-cite-them-right.csl"
link-citations: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
```

```{r, include=FALSE}
# Import all data from the tab-separated data file which is held in the data sub-folder

#file_path <- file.path(getwd(),'/Data/Energy_September_2024_Final.txt')
file_path <- './Data/Energy_September_2024_Final.txt'
energy_df <- read.delim((file_path))

# Convert the string date to a valid date format, add it to the dataframe and remove the old one
#valid_dates <- as.Date(energy_df$Date, '%d/%m/%Y')
#energy_df = data.frame(valid_dates, energy_df)
#energy_df$Date <- NULL
#colnames(energy_df)[colnames(energy_df) == 'valid_dates'] <- 'Date'

# Convert the string date to a valid date format
energy_df$Date <- as.Date(energy_df$Date, '%d/%m/%Y')

```

# Introduction (20 marks)

(20 Marks)

-   Origin
-   Why is it important to me
-   Show first 5 or 6 lines of data to help understanding

## Objectives

This report looks at the use of solar energy during September 2024 in a domestic property in the southern highlands of Scotland. The property previously used oil for heating and electricity for lighting and cooking but this was changed in order to reduce running costs and the carbon-footprint of the property. A solar array, battery and ground source heat pump were installed to totally remove the need for oil and rely on solar generated electricity with import from the grid to add as needed.

The main aims of the data analysis are to answer the following questions:

1.  How effectively does the solar generation cover energy consumption?
2.  When does the solar generation fall short and require grid import?
3.  Would additional battery storage capacity cover shortfalls?
4.  Does the installation meet the expectations at the time of purchase?

***WIP - Analysis, expected conclusions:***

1)  Consumption is covered by solar .. or not? how much? how much grid still needed
2)  Consumption is linked to temperature and house occupancy
3)  Solar generation is linked to irradiance .. but how much?
4)  Any other links such as temperature? .. probably not usage or occupancy though?
5)  ?? Cannot account for Â£ cost and different costs at times of day .. battery importing then for example
6)  ?? Battery timing in and out complicates the analysis?
7)  Increased battery will smooth out across days? forecast storage/impact .. but can't see the intra-day detail to better analyse
8)  Solar generation meets the forecasts at purchase .. need original data/estimates!?

## Summary of The Data

The data comprises four main parts:

-   Weather: Daily temperature and solar irradiance readings
-   Energy Use: Daily data for electricity consumption
-   Energy Source: Daily data for the source of electricity: solar, battery or import from the grid
-   House Occupation: A simple flag to indicate if the house is occupied or not

All data and supporting files can be found online at [Github](https://github.com/StuartG24/Home-Solar-Usage-Analysis)

### Weather

Weather data is sourced from [Balquhidder Weather Station](https://www.blscc.org/weather) and consists of:

-   Temp_Avg - the mean daily temperature in $^\circ$C and is derived from 6 readings taken at 4 hourly intervals during a 24 hour period.
-   Irradiance - a measure of the solar energy experienced over a specified area and is measure in W/m$^2$ [^1]. Typically this is used to actually calculate the power generated from an array of solar panels, [*but here it is used here as a proxy for daily sunshine hours because this data was not available.*]{.underline}

[^1]: Wikipedia: <https://en.wikipedia.org/wiki/Solar_irradiance>

***TO DO: Recalculate the irradiance figues to give a better average approximation for the day .. but continue analysis approach meanwhile***

### Energy Use & Source

The distribution of power for the house is managed by a Tesla Powerwall and Controller and an iPhone app is used to monitor this, see Figure 1. All electricity data was downloaded from this app. Electricity is measured in kWh.

Electricity is sourced from:

-   From_Solar - solar power from an array of 36 solar panels
-   From_Battery - battery storage
-   From_Grid - the national power grid

The controller then intelligently routes electricity to:

-   Home - consumption by the house
-   To_Battery - battery storage
-   To_Grid - export to the national power grid.

![Tesla Powerwall App](TeslaPowerwallApp.jpeg){width="25%"}

### Data Analysed

*TO DO: Tidy up table columns display .... look at Pandoc options etc to change layout for table and whole document? <https://pandoc.org/MANUAL.html#synopsis>*

Once the three sources of data have been collated the dataset for analysis consists of the below:

```{r echo=FALSE}
# Display the first 6 rows of the data
kable(head(energy_df), caption = 'First 6 Rows of the source dataset')
```

The dataset consists of:

-   30 observations, for each day in September 2024
-   Home: The total electricity, kWh, used by the home all day
-   From\_ Solar, Grid, Battery: The total electricity provided by the solar panels, power grid and battery respectively. All kWh.
-   To\_ Grid, Battery: The total electricity exported to the power grid or stored by battery. All kWh.

The following plots etc etc

```{r, echo=FALSE,fig.cap="First plot", out.width="90%"}
plot(energy_df$Home~energy_df$Date, type = 'l', col = 'red')
lines(energy_df$Date, energy_df$Temp_Avg, type = 'l', col = "blue")
lines(energy_df$Date, energy_df$Occupied*20, type = 'h', col = "green")
legend("topright", legend = c("Home", "Temp", "Occupied"), 
       col = c("red", "blue", "green"), lty = 1)
```

```{r, echo=FALSE, fig.cap="Second plot", out.width="90%"}
plot(energy_df$Date, energy_df$From_Solar, type = 'l', col = "red")
lines(energy_df$Date, energy_df$Irradiance/150, type = 'l', col = "blue")
legend("topright", legend = c("Solar", "Irradiance", "xx"), 
       col = c("red", "blue", "green"), lty = 1)
```

\newpage

# Methods and Results

(40 marks)

## Method

*TO DO: Should data introduction and visualisation be here instead?*

## Results

*TO DO: Have a look back at the Bran Lab report for Spring 2018, for how to present means, SD etc etc*

# Conclusions

(20 marks)

##?? Discussion

*TO DO: Structure into two sections*

##?? Conclusion

Test citations [@Crawley2014] and as @Fraix-Burnet2016

@spiegel2012

\newpage

# References
