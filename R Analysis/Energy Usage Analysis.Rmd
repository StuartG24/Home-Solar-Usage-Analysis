---
title: "Energy Usage Analysis"
subtitle: "An Analysis of Solar Generation Effectiveness"
author: "Student Number: 2710017"
date: "14 November 2024"
output:
  pdf_document: default
  html_document: default
links-as-notes: true
header-includes:
  \usepackage{lastpage}
  \usepackage{fancyhdr}
  \pagestyle{fancy}
  \fancyhead[L]{Energy Usage Analysis}
  \fancyhead[C]{}
  \fancyhead[R]{\thepage\ of \pageref{LastPage}}
  \fancyfoot[C]{}
bibliography: references.bib
csl: "harvard-cite-them-right.csl"
link-citations: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
```

```{r, include=FALSE}
# Import all data from the tab-separated data file which is held in the data sub-folder
file_path <- './Data/Energy_September_2024.txt'
energy_df <- read.delim((file_path))

# Convert the string date to a valid date format
energy_df$Date <- as.Date(energy_df$Date, '%d/%m/%Y')
```

# Introduction (20 marks)

(20 Marks)

-   Origin
-   Why is it important to me
-   Show first 5 or 6 lines of data to help understanding

## Objectives

This report looks at the use of solar energy during September 2024 in a domestic property in the southern highlands of Scotland. The property previously used oil for heating and electricity for lighting plus cooking but this was changed in order to reduce running costs and the carbon-footprint of the property. A solar array, battery and ground source heat pump were installed in order to attempt to rely solely on solar generated electricity and supplemented with import from the electricity grid only to compensate for short-falls.

The main aims of this data analysis is to answer the following questions:

1.  How effectively does the solar generation cover energy consumption?
2.  When specifically does the solar generation fall short and require grid import?
3.  Would additional battery storage capacity cover these shortfalls?
4.  Does the installation meet the expectations at the time of purchase?

***WIP - Analysis, expected conclusions:***

1)  Consumption is covered by solar .. or not? how much? how much grid still needed
2)  Consumption is linked to temperature and house occupancy
3)  Solar generation is linked to irradiance .. but how much?
4)  Any other links such as temperature? .. probably not usage or occupancy though?
5)  ?? Cannot account for Â£ cost and different costs at times of day .. battery importing then for example
6)  ?? Battery timing in and out complicates the analysis?
7)  Increased battery will smooth out across days? forecast storage/impact .. but can't see the intra-day detail to better analyse
8)  Solar generation meets the forecasts at purchase .. need original data/estimates!?

## Summary of The Data

The data analysed comprises four parts, all daily data, 30 observations, for each day in September 2024:

-   Weather: Temperature and solar irradiance readings
-   Energy Use: Electricity consumption
-   Energy Source: The source of electricity: solar, battery or import from the grid
-   *Occupied*: A Y/N flag to indicate if the house is occupied or not

All data and supporting files can be found online at [Github](https://github.com/StuartG24/Home-Solar-Usage-Analysis).

### Weather

Weather data is sourced from the [Balquhidder Weather Station](https://www.blscc.org/weather) and consists of:

-   *Temp* - the mean daily temperature in $^\circ$C and is derived from 6 readings taken at 4 hourly intervals over a 24 hour period
-   *Irrdnce* - irradiance, a measure of the solar energy experienced over a specified area, units are W/m$^2$ and his is used to actually calculate the power generated from an array of solar panels[^1]

[^1]: Wikipedia: <https://en.wikipedia.org/wiki/Solar_irradiance>

### Energy Use & Source

The distribution of power for the house is managed by a Tesla Powerwall and Controller and an iPhone app is used to monitor this, see Figure 1. All electricity data was downloaded from this app. Electricity is measured in kWh.

Electricity is sourced from:

-   *From_Solar* - solar power generated by an array of 36 solar panels
-   *From_Battery* - battery storage
-   *From_Grid* - the national power grid

The controller then intelligently routes electricity to:

-   *To_Home* - consumption by the house
-   *To_Battery* - for battery storage
-   *To_Grid* - export to the national power grid

![Tesla Powerwall](TeslaPowerwallApp.jpeg){width="75%"}

\newpage

## Initial Data Examination

***TO DO:** Tidy up table columns display .... look at Pandoc options etc to change layout for table and whole document? <https://pandoc.org/MANUAL.html#synopsis>*

Once the three sources of data have been collated and loaded the dataset consists of 30 observations and 10 columns. The first 6 rows are shown below:

```{r}
# Display the first 6 rows of the data
#kable(head(energy_df), caption = 'First 6 Rows of the source dataset')
head(energy_df)
```

Some simple visualisations were then used to better understand the data and see if there were any obvious relationships to explore further.

-   A bar plot of the total daily usage and its source (Solar, Battery, Grid)

-   Similarly for generation each day and how it was directed (Directly used, stored in battyer, exported to the grid ..

-   ?? overlay temp, irradiance, solar generation

-   ?? Overlay temperture and occupation over house usage

-   ?? Overlay irradiance and solar generation

The daily usage and source of energy was visually examined using the two bar plots below. In the first bar plot, it appears that the energy generated by the solar panels only meets a small proportion of the total daily consumption, on average 26%. However, this figure could be misleading as solar energy is stored in the battery (as can be seen in the second bar plot) and then used later. A more reasonable approximation is to take off grid import from usage to approximate how much energy is originated from solar generation which is 80%.

```{r}
average_solar_percent <- mean(c(energy_df$From_Solar / energy_df$Home_Total)) * 100
adjusted_solar_percent <- mean(c(energy_df$Solar_Total / energy_df$Home_Total)) * 100
adjusted_solar_percentG <- mean(c((energy_df$Home_Total - energy_df$From_Grid) / 
                                    energy_df$Home_Total)) * 100

print(paste("Straight percentage:", average_solar_percent, 
            "Adjusted estimate:", adjusted_solar_percent,
            "Removing Grid Sourced:", adjusted_solar_percentG))
```

```{r, out.width="90%", echo=FALSE}
# Convert to matrix for stacked bar plot
usage <- t(energy_df)[c("From_Solar", "From_Pwall", "From_Grid"), ]
barplot(usage, names.arg = format(energy_df$Date, "%d %b"), 
        cex.name=0.9, las=2, cex.axis=0.7, 
        main="Daily Energy Use & Sources", ylab="Electricity WH", 
        col=3:1, ylim=c(0,25000))

legend("top", legend=c("From_Solar", "From_Pwall", "From_Grid"), title="Sources", 
       fill = 3:1, cex = 0.6)
```

```{r, out.width="90%", echo=FALSE}
# Convert to matrix for stacked bar plot
generation <- t(energy_df)[c("To_Home", "To_Pwall", "To_Grid"), ]
barplot(generation, names.arg = format(energy_df$Date, "%d %b"), 
        cex.name=0.9, las=2, cex.axis=0.7, 
        main="Daily Solar Generation & Target", ylab="Electricity WH", 
        col=3:1, ylim=c(0,25000))
legend("top", legend=c("To-Home", "To_Pwall", "To_Grid"), title="Targets", 
       fill = 3:1, cex = 0.6)
```

```{r, fig.cap="Solar Generation & Its Target", out.width="90%"}

```

```{r, fig.cap="First plot", out.width="90%"}
plot(energy_df$To_Home ~ energy_df$Date, type = 'l', col = 'red')
lines(energy_df$Date, energy_df$Temp, type = 'l', col = "blue")
lines(energy_df$Date, energy_df$Occupied*20, type = 'h', col = "green")
legend("topright", legend = c("Home", "Temp", "Occupied"), 
       col = c("red", "blue", "green"), lty = 1)
```

```{r, fig.cap="Second plot", out.width="90%"}
plot(energy_df$Date, energy_df$From_Solar, type = 'l', col = "red")
lines(energy_df$Date, energy_df$Irrdnce/150, type = 'l', col = "blue")
legend("topright", legend = c("Solar", "Irradiance", "xx"), 
       col = c("red", "blue", "green"), lty = 1)
```

\newpage

# Methods and Results

(40 marks)

## Method

*TO DO: Should data introduction and visualisation be here instead?*

## Results

*TO DO: Have a look back at the Bran Lab report for Spring 2018, for how to present means, SD etc etc*

# Conclusions

(20 marks)

##?? Discussion

*TO DO: Structure into two sections*

##?? Conclusion

Test citations [@Crawley2014] and as @Fraix-Burnet2016

@spiegel2012

\newpage

# References
