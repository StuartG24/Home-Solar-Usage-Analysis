---
title: "Energy Usage Analysis"
subtitle: "An Analysis of Solar Generation Effectiveness"
author: "Student Number: 2710017"
date: "25 November 2024"
output:
  pdf_document: default
  html_document: default
links-as-notes: true
header-includes:
  \usepackage{lastpage}
  \usepackage{fancyhdr}
  \pagestyle{fancy}
  \fancyhead[L]{Energy Usage Analysis}
  \fancyhead[C]{}
  \fancyhead[R]{\thepage\ of \pageref{LastPage}}
  \fancyfoot[C]{}
bibliography: references.bib
csl: "harvard-cite-them-right.csl"
link-citations: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
options(digits = 4)
```

# Introduction (20 marks)

## Objectives

About six years ago, I decided to remove my reliance on oil and attempt to reduce my use of electricity imported from the National Grid. This was to try to reduce my energy costs and also as part of my small contribution towards reducing the use of fossil fuels. So I obtained installation costs and received estimates on how much energy I could generate by using solar panels. The existing setup of oil powered central heating was replaced by an installation of a solar panel array, battery storage and ground source heat pump. The aim was to be able to export surplus electricity and only import when generation and storage failed to meet the demands of the house.

My main objective is to see if the installation meets the predictions made during the sales process and to what extent I no longer have to rely on imported electricity, ie how effective the overall installation is and would, for example, additional battery storage improve it. I used a sample of data for the month of September 2024 as a hopefully representative month (ie not the height of summer with peak solar generation and not winter with low solar generation and peak consumption).

In the final report, R code and outputs have been shown to demonstrate working, however to reduce the size of the document this is suppressed if repeating previous workings. It is obviously all available in the submitted .rmd file.

## Summary of The Data

The data was collated from three original sources and combined into a single .txt file, then imported as an R dataframe.

```{r}
# Import all data from the tab-separated data file which is held in the data sub-folder
file_path <- './Data/Energy_September_2024.txt'
energy_df <- read.delim((file_path))
# Convert the string date to a valid date format
energy_df$Date <- as.Date(energy_df$Date, '%d/%m/%Y')
```

The data analysed comprises four parts, all daily data, 30 observations, for each day in September 2024:

-   Weather: Temperature and solar irradiance readings
-   Energy Use: Electricity consumption
-   Energy Source: The source of electricity: solar, battery or import from the grid
-   *Occupied*: The approximate number of hours the house is occupied each day

All data and supporting files can be found online at [Github](https://github.com/StuartG24/Home-Solar-Usage-Analysis).

### Weather

Weather data is sourced from the [Balquhidder Weather Station](https://www.blscc.org/weather) and consists of:

-   *Temp* - the mean daily temperature in $^\circ$C which is derived from 6 readings taken at 4 hourly intervals over a 24 hour period
-   *Irrdnce* - irradiance, a measure of the solar energy experienced over a specified area, units are kW/m$^2$ or W/m$^2$ and this is used to calculate the theoretical power generated from an array of solar panels[^1]

[^1]: Wikipedia: <https://en.wikipedia.org/wiki/Solar_irradiance>

### Energy Use & Source

The distribution of power for the house is managed by a Tesla Powerwall and Controller and an iPhone app is used to monitor this, see Figure 1. All electricity data was downloaded via this app. The imported electricity data was in Wh but is usually reported in kWh.

Electricity used and where it is sourced from:

-   *Home_Total* - total energy used by the house
-   *From_Solar* - solar power generated by an array of 36 solar panels
-   *From_PWall* - battery storage
-   *From_Grid* - the national power grid

Electricity generated by the solar panels and where it is used (the controller intelligently makes the routing decisions):

-   *Solar_Total* - total energy generated by the solar panels
-   *To_Home* - consumption by the house
-   *To_PWall* - for battery storage
-   *To_Grid* - export to the national power grid

Once the sources of data have been collated and loaded the dataset consists of 30 observations and 12 columns; the first 4 rows are shown below:
```{r}
# Display the first 4 rows of the data
head(energy_df,4)
```



```{r, size="small",echo=FALSE}
# Display the first 6 rows of the data
#head(energy_df)
#kable(head(energy_df), caption = 'First 6 Rows of the source dataset')
```

![Tesla Powerwall](TeslaPowerwallApp.jpeg){width="40%"}

# Methods and Results - (40 marks)

The data was analysed in several groups and themes, in summary:

-   Energy Consumption - What drives energy consumption?
-   Solar Generation Effectiveness - How well does the installation meet sales promises?
-   Solar Energy Sufficiency - How well does solar meet energy demand?

## Energy Consumption

*Sanity Check*

The energy consumption (electricity in kWh) of the house was compared to the weather and to occupancy, summarised in the figure below (nb: temperature and occupancy have been scaled to only show the relative size and so no values are displayed). 

```{r, fig.dim=c(8,5), fig.align='center'}
# Base barplot of energy consumption
barplot_result <- barplot(energy_df$Home_Total/1000, names.arg = format(energy_df$Date, "%d %b"), 
        cex.name=0.9, las=2, cex.axis=0.7, main="Daily Energy Consumption vs Weather & Occupancy", 
        ylab="Electricity kWh", ylim=c(0,25), col = 'lightblue', space = 1.5)

# Add scaled lines for temperature and occupancy
scaled_temp <- energy_df$Temp * max(energy_df$Home_Total/1000) / max(energy_df$Temp)
lines(barplot_result, scaled_temp, type = 'l', col = "red")
scaled_occ <- energy_df$Occupied * max(energy_df$Home_Total/1000) / max(energy_df$Occupied)
lines(barplot_result, scaled_occ, type = 'h', col = "darkblue", lwd = 2)
legend('top', legend=c("Electricty", "Temperature", "Occupancy"),
       fill=c("lightblue", "red", "darkblue"), cex = 0.6)
```

A quick examination of the energy demand was completed to visualise the distribution and identify any outliers.


```{r, fig.dim=c(8,4), fig.align='center'}
# The distribution of energy consumption in September
hist(energy_df$Home_Total/1000, main="Energy Consumption", xlab= "Electricity kWh", ylab="Days Count", 
         col = 'lightblue', xlim=c(0,30))
```

```{r, fig.dim=c(8,4), fig.align='center'}
# Box plot of energy consumption in September
boxplot(energy_df$Home_Total/1000, main="Energy Consumption", xlab= "Electricity kWh", ylab="September", 
         col = 'lightblue', ylim=c(0,30), horizontal = TRUE)
```

*Relationships Between Demand and Other Factors*

It was expected that the energy demand from the house should be related to the occupancy and the temperature, however visually there does not appear to be a strong link with temperature but potentially there is a link with occupancy. So three linear regressions were carried out to better identify any relationships.

First looking at the relationship between energy demand and occupancy.

```{r, fig.dim=c(6,3.5), fig.align='center'}
# Plots and linear regression for energy and occupancy
regression_model <- lm(energy_df$Home_Total/1000 ~ energy_df$Occupied)
regression_summary <- summary((regression_model))
alpha <- regression_summary$coefficients["(Intercept)", "Estimate"]
beta <- regression_summary$coefficients["energy_df$Occupied", "Estimate"]
p_value <- regression_summary$coefficients["energy_df$Occupied", "Pr(>|t|)"]
adj_r_squared <- regression_summary$adj.r.squared

plot(energy_df$Home_Total/1000 ~ energy_df$Occupied, main="Daily Energy Demand vs Occupancy", 
     xlab="Occupancy Hours", ylab="Electricity kWh", las=1, xlim=c(0,25),
     pch=21, bg="lightblue")
abline(regression_model, col="darkblue")
```

The regression line determined was energy =`r format(alpha, digits=4)` ($\alpha$) + `r format(beta, digits=4)` ($\beta$) \* occupancy. This fit had a p-value of `r format(p_value, digits=3)` and adjusted R-squared of `r format(adj_r_squared, digits=2)`. For a linear regression the null hypothesis is that $\beta$ is zero, ie $H_0: \beta = 0$. Here the p-value is less than the 5% critical value and so we can reject $H_0$ and infer that energy and occupancy are correlated, however the relative low value of adjusted R-squared suggests that the correlation is not very strong.

Then looking at the relationship between energy demand and temperature (NB: same R Code so not printed to save space).

```{r, fig.dim=c(6,3.5), fig.align='center', echo=FALSE}
# Plots and linear regression for energy and temperature
regression_model <- lm(energy_df$Home_Total/1000 ~ energy_df$Temp)
regression_summary <- summary((regression_model))
alpha <- regression_summary$coefficients["(Intercept)", "Estimate"]
beta <- regression_summary$coefficients["energy_df$Temp", "Estimate"]
p_value <- regression_summary$coefficients["energy_df$Temp", "Pr(>|t|)"]
adj_r_squared <- regression_summary$adj.r.squared

plot(energy_df$Home_Total/1000 ~ energy_df$Temp, main="Daily Energy Demand vs Temperature", 
     xlab="Temperature", ylab="Electricity kWh", las=1, xlim=c(0,20),ylim=c(0,40),
     pch=21, bg="lightblue")
abline(regression_model, col="darkblue")
#print(sprintf("Alpha: %.3f, Beta: %.3f", alpha, beta))
#print(sprintf("p-value: %.4f, Adj R-Squared: %.3f", p_value, adj_r_squared))
```

The regression line determined was energy =`r format(alpha, digits=4)` ($\alpha$) + `r format(beta, digits=4)` ($\beta$) \* temperature. This fit had a p-value of `r format(p_value, digits=2)` and adjusted R-squared of `r format(adj_r_squared, digits=2)`. Here the p-value is less than the 5% critical value and so we can reject $H_0$ and infer that energy and temperature are inversely correlated, however the relative low value of adjusted R-squared suggests that the correlation is not very strong.

Then a multi-linear regression was performed looking at the relationship between energy demand and temperature plus occupancy (NB: A three dimensional scatter plot was not attempted).

```{r, fig.dim=c(6,4), fig.align='center', echo=TRUE}
# Multiple linear regression for energy and occupancy + temperature
regression_model <- lm(energy_df$Home_Total/1000 ~ energy_df$Temp + energy_df$Occupied)
regression_summary <- summary((regression_model))
alpha <- regression_summary$coefficients["(Intercept)", "Estimate"]
beta0 <- regression_summary$coefficients["energy_df$Occupied", "Estimate"]
p_value0 <- regression_summary$coefficients["energy_df$Occupied", "Pr(>|t|)"]
beta1 <- regression_summary$coefficients["energy_df$Temp", "Estimate"]
p_value1 <- regression_summary$coefficients["energy_df$Temp", "Pr(>|t|)"]
adj_r_squared <- regression_summary$adj.r.squared

#print(sprintf("Alpha: %.3f, Beta Occupancy: %.3f, Beta Temp: %.3f", alpha, beta0, beta1))
#print(sprintf("p-value Occp: %.4f, p-value Temp: %.4f, Adj R-Squared: %.3f", p_value0, p_value1, adj_r_squared))
```

The regression line determined was energy = `r format(alpha, digits=4)` ($\alpha$) + `r format(beta0, digits=4)` ($\beta$) \* occupancy + `r format(beta1, digits=4)` ($\beta$) \* temperature This fit had a p-value of `r format(p_value0, digits=3)` for occupancy and `r format(p_value1, digits=3)` for temperature and adjusted R-squared of `r format(adj_r_squared, digits=2)`. Here both p-values are less than the 5% critical value and so we can reject $H_0$ and infer that energy and occupancy plus temperature (inversely) are correlated, the high value of adjusted R-squared suggests that the correlation is quite strong.

## Solar Generation Effectiveness

The amount of energy generated by solar panels is a function of their size and the level of sunshine received, measured by irradiance. There is also a loss factor that reflects several things including the efficiency of the solar panels and the invertor. Additionally, irradiance observations are taken from local weather stations which may not experience the same shading from the sun as that experienced at the site of the solar panels. $$ Power (kWh) = Area (m^2) * Irradiance (kWh/m^2) * LossFactor$$

```{r, echo=TRUE}
# The installation assumptions
solar_panels_count <- 36
solar_panels_area <- solar_panels_count * 2
solar_panels_max <- solar_panels_count * 275
solar_estimated_pa <- 7920
loss_factor <- solar_estimated_pa / solar_panels_max
irradiance_assumed <- solar_panels_max / solar_panels_area
```

At installation, the annual generation power for this solar array was calculated as `r format(solar_estimated_pa, digits=2, big.mark=",")` kWh pa using an area of `r solar_panels_area` $m^2$, irradiance `r irradiance_assumed` kWh/$m^2$ pa and a loss factor of `r loss_factor`. Using the September observations of irradiance and generated solar energy, the effectiveness of the installation can be compared to the estimates (sales promises) made originally. It is very likely that the sales estimates were optimistic.

*Link Between Energy Generation & Irradiance*

```{r, fig.dim=c(6,4), fig.align='center', echo=TRUE}
# For solar generation, how well is this predicted by irradiance?
regression_model <- lm(energy_df$Solar_Total/1000 ~ energy_df$Irrdnce)
regression_summary <- summary(regression_model)

plot(energy_df$Solar_Total/1000 ~ energy_df$Irrdnce, 
     main="Fit for Daily Solar Energy vs Irradiance", xlab="Irradiance kWh/m2", ylab="Electricity kWh",
     pch=21, bg="lightblue")
abline(regression_model, col="darkblue")
alpha <- regression_summary$coefficients["(Intercept)", "Estimate"]
beta0 <- regression_summary$coefficients["energy_df$Irrdnce", "Estimate"]
p_value1 <- regression_summary$coefficients["energy_df$Irrdnce", "Pr(>|t|)"]
adj_r_squared <- regression_summary$adj.r.squared

#print(sprintf("Alpha: %.3f, Beta Irradiation: %.3f", alpha, beta0))
#print(sprintf("p-value Irradiation: %.4f, Adj R-Squared: %.3f", p_value0, adj_r_squared))
# Good fit between solar energy and irradiation with p-value < 5% and a high r-squared
```

It was expected that the generated solar energy is related to the irradiance and a quick scatter plot and linear regression confirmed this, with a p-value `r ifelse(p_value1 < 0.005, "< 0.005", round(p_value1, 3))` and a high adjusted r-squared `r format(adj_r_squared, digits=2)`.

*Evaluate Effectiveness - T-Test*

```{r, echo=FALSE, include=FALSE}
# Compare the actual solar energy against the predicted energy based on  irradiance
solar_predicted <- energy_df$Irrdnce/1000 * solar_panels_area * loss_factor
#summary(energy_df[,c("Solar_Total", "Irrdnce", "Temp")])
summary(energy_df$Solar_Total/1000)
sum(energy_df$Solar_Total/1000)
summary(solar_predicted)
sum(solar_predicted)

plot(energy_df$Solar_Total/1000 ~ energy_df$Date, type = "l", col = "blue")
plot(solar_predicted ~ energy_df$Date, type = "l", col = "lightblue")
plot(energy_df$Irrdnce/1000 ~ energy_df$Date, type = "l", col = "red")
plot(energy_df$Temp ~ energy_df$Date, type = "l", col = "green")
```

The sales prediction for the daily solar energy was calculated using the formulae above and with the irradiance observations during September. The means for the month are `r format(mean(energy_df$Solar_Total/1000), digits=3)` kWh and `r format(mean(solar_predicted), digits=3)` kWh respectively. The daily totals are compared in the plot below.

```{r, fig.dim=c(8,5), fig.align='center', echo=FALSE}
# Barplot of solar generation & solar predicted
barplot_result <- barplot(energy_df$Solar_Total/1000, names.arg = format(energy_df$Date, "%d %b"), 
        cex.name=0.9, las=2, cex.axis=0.7, main="Daily Solar Generation vs Predicted", 
        ylab="Electricity kWh", ylim=c(0,20), col = 'blue', space = 1.5)
lines(barplot_result, solar_predicted, type = 'h', col = "orange", lwd = 2)
legend('top', legend=c("Actual Observed", "Predicted"),
       fill=c("blue", "orange"), cex = 0.6)

# !! also show a scatter plot of the two
```

The figure clearly shows that the predicted generation is higher than the actual, although the differences do vary. Further examination was completed to better understand this. A scatter plot below shows the relationship between the predicted and generated energy.

```{r, fig.dim=c(6,4), fig.align='center', echo=TRUE}
# Scatter plot and regression for solar generation & solar predicted
regression_model <- lm(energy_df$Solar_Total/1000 ~ solar_predicted)
regression_summary <- summary(regression_model)

plot(energy_df$Solar_Total/1000 ~ solar_predicted, 
     main="Solar Energy Actual vs Predicted (kWh)", xlab="Predicted", ylab="Actual",
     pch=21, bg="lightblue")
abline(regression_model, col="darkblue")
alpha <- regression_summary$coefficients["(Intercept)", "Estimate"]
beta0 <- regression_summary$coefficients["solar_predicted", "Estimate"]
p_value1 <- regression_summary$coefficients["solar_predicted", "Pr(>|t|)"]
adj_r_squared <- regression_summary$adj.r.squared

#print(sprintf("Alpha: %.3f, Beta Irradiation: %.3f", alpha, beta0))
#print(sprintf("p-value Irradiation: %.4f, Adj R-Squared: %.3f", p_value0, adj_r_squared))
```

As expected the actual generated solar energy vs predicted do appear to fit well, with a p-value `r ifelse(p_value1 < 0.005, "< 0.005", round(p_value1, 3))` and a high adjusted r-squared `r format(adj_r_squared, digits=2)`.

To try to better understand the relationship between the actual and predicted energy, a T-Test was completed. The null hypothesis is that the installation performs as well as the sales promises; specifically that the average daily energy production in September $\mu_{act}$ is the same as that promised (expected) $\mu_{exp}$. $$H_0:\mu_{act} = \mu_{exp}$$ the alternative hypothesis is that the installation does not perform as promised $$H_1:\mu_{act} < \mu_{exp}$$

A T-Test was performed to evaluate $H_0$ and to calculate the p-value which is the probability, if $H_0$ is true, of obtaining the observation, or an observation more extreme. In this case more extreme is that the actual mean observed is less than the expected mean because we suspect that the installation does not perform as well as the sales promises; so a one-tailed paired test was used. Log values were used to try to make both samples closer to a normal distribution.

```{r}
# Evaluate the T-Test
#t_test_result <- t.test(energy_df$Solar_Total/1000, solar_predicted, alternative = "less", paired = TRUE)
t_test_result <- t.test(log10(energy_df$Solar_Total/1000), log10(solar_predicted), alternative = "less", paired = TRUE)
```

The p-value is `r ifelse(t_test_result$p.value< 0.005, "< 0.005", round(t_test_result$p.value, 3))` which is statistically significant and the null hypothesis can be rejected at the 5% level. From this we can infer that the installation is not generating solar energy as effectively as originally promised.

*Evaluate Effectiveness - Binomial Probability*

```{r}
# How often are the actual values less then the predicted?
occurrences = sum(table(energy_df$Solar_Total/1000 < solar_predicted))
```

To confirm the above, further analysis was performed, to look at the frequency of actual daily generation being less than the predicted generation ($energy_{act} < energy_{exp}$). In September this happened on `r format(occurrences)` days out of 30. The null hypothesis is that we should always achieve the predicted generation, so $$H_0: p(energy_{act} < energy_{exp}) = 0$$

```{r}
# Determine the p-value for act < predicted on the given number of occurrences 
# In a 30 day month and H0 saying the probability is zero
p_value <- dbinom(occurrences, 30, 0)
```

The p-value is `r ifelse(p_value< 0.005, "< 0.005", round(p_value, 3))` which is statistically significant and the null hypothesis can be rejected at the 5% level. From this we can infer that the installation is not generating solar energy as effectively as originally promised.

## Solar Energy Sufficiency

The energy demands of the house were examined to see how well solar generated electricity matched this demand and how much any shortfalls needed to covered by imported electricity. The first stacked bar plot below shows the daily total energy consumed and how much is provided by: solar generation; the battery; or imported electricity. The second plot shows the daily total solar energy generated and where this is distributed to.

```{r, fig.dim=c(8,5), fig.align='center'}
# Stacked bar plot of daily energy consumption and the three sources of energy

# Transpose to matrix to use for stacked bar plot
usage <- t(energy_df)[c("From_Solar", "From_Pwall", "From_Grid"),]

barplot(usage, names.arg = format(energy_df$Date, "%d %b"), 
        cex.name=0.9, las=2, cex.axis=0.7, 
        main="Daily Energy Consumption & Sources", ylab="Electricity Wh", 
        col=3:1, ylim=c(0,25000))
legend('top', legend=c("From Solar", "From Battery", "From Grid"), title="Sources", 
       fill = 3:1, cex = 0.6)


```

```{r, fig.dim=c(8,5), fig.align='center', echo=FALSE}
# Stacked bar plot of daily solar generation and the three ares this is distributed to

# Transpose to matrix to use for stacked bar plot
generation <- t(energy_df)[c("To_Home", "To_Pwall", "To_Grid"), ]

barplot(generation, names.arg = format(energy_df$Date, "%d %b"), 
        cex.name=0.9, las=2, cex.axis=0.7, 
        main="Daily Solar Generation & Target", ylab="Electricity Wh", 
        col=3:1, ylim=c(0,25000))
legend('top', legend=c("To Home", "To Battery", "To Grid"), title="Targets", 
       fill = 3:1, cex = 0.6)
```

```{r}
# Calculate how the energy is consumed and distributed

average_solar_percent <- mean(c(energy_df$From_Solar / energy_df$Home_Total)) * 100
#print(paste("Straight percentage:", average_solar_percent))

solar_home_percent <- mean(c(energy_df$To_Home / energy_df$Solar_Total)) * 100
solar_powerwall_percent <- mean(c(energy_df$To_Pwall / energy_df$Solar_Total)) * 100
solar_grid_percent <- mean(c(energy_df$To_Grid / energy_df$Solar_Total)) * 100
#print(paste("To Home:", solar_home_percent, "To Powerwall:", solar_powerwall_percent, "To Grid:", solar_grid_percent))

adjusted_solar_percent <- mean(c((energy_df$Home_Total - energy_df$From_Grid) / 
                                    energy_df$Home_Total)) * 100
# print(paste("Without Grid Imported:", adjusted_solar_percent))
```

The first bar plot appears to clearly show that the generated solar energy is not sufficient to meet the total consumption needs, on average it only meets `r round(average_solar_percent, digits = 0)`% of the daily demand. However, this is misleading as generated solar energy is often first stored in the battery for later use (nb it is sometime also to exported to the gird if the battery becomes full). The second bar plot shows this more clearly, with solar energy distributed to the home, the battery or exported to the grid on average: `r round(solar_home_percent, digits = 0)`%, `r round(solar_powerwall_percent, digits = 0)`%, `r round(solar_grid_percent, digits = 0)`% respectively.

An alternative approximation of how well the solar generation meets the needs of the house's energy consumption is to look at how much usage is catered for without any import from the grid which suggests approximately `r round(adjusted_solar_percent, digits = 0)`% is utlimately provided by solar energy.

*Successfully Meeting Demand*

In a previous section, looking at energy consumption, it appeared that occupancy was the bigger predictor of daily energy use. So it is interesting to see the relationship between successfully meeting demand (say, solar provides \> 75% of energy) and significant occupancy (say, occupied \> 50% of the day). I suspect that the generated solar energy does not meet the demands of a fully occupied house.

For September, the true/false occurrence of meeting demand and of being occupied were determined and a contingency table prepared.

```{r}
# Prepare a contingency table looking at meeting demand vs occupation

# Determine true / false for each combination
demand_met <- ((energy_df$Home_Total - energy_df$From_Grid) / energy_df$Home_Total) > 0.75
occupied <- (energy_df$Occupied / 24) > 0.5
demandT_occpT <- sum(demand_met & occupied)
demandT_occpF <- sum(demand_met & !occupied)
demandF_occpT <- sum(!demand_met & occupied)
demandF_occpF <- sum(!demand_met & !occupied)

# Create matrix and display
contingency_table <- matrix(c(demandT_occpT,demandT_occpF,demandF_occpT,demandF_occpF), 2, 2)
dimnames(contingency_table) <- list(Demand_Met=c(TRUE,FALSE), Occupied=c(TRUE,FALSE))
print(contingency_table)
```
This shows that demand is met in an occupied house on only `r round(demandT_occpT)` days out of 30, about `r round((demandT_occpT/30)*100)`% of the month; however, we need to determine if this is statistically significant. A null hypothesis to consider is $$H_0: p(demandmet|occupied) = p(demandmet|\overline{occupied})$$.

The contingency table is used to perform a Fisher's exact test to determine the p-value which is the probability, if the null hypothesis is true, of obtaining the observation, or an observation more extreme. In this case more extreme is that demand is met less frequently, so a one-sided test is used.

```{r}
# Perform Fisher's Exact Test - a on-sided test

result = fisher.test(contingency_table, alternative = "less")
p_value_f = result$p.value
```

The results of a one-sided Fisher's exact test gave a p-value of `r ifelse(p_value_f < 0.005, "< 0.005", round(p_value_f, 3))`, this is above the critical 5% value and so we cannot reject the null hypothesis; there is no evidence to suggest that the demand is not met. This does seem surprising.

\newpage

# Conclusions - 20 marks

### Energy Consumption

-   Analysis showed that energy consumption is strongly linked to combined temperature and occupancy
-   However the link with temperature only was surprisngly weak
    -   The temperature in September was only in the range `r round(min(energy_df$Temp), digits = 0)` to `r round(max(energy_df$Temp), digits = 0)` with a mean of `r round(mean(energy_df$Temp), digits = 1)` and this is not very extreme.
    -   Good insulation with the above may have reduced the impact, colder weather will have a bigger impact, the calcuated regression line suggess this with an aenergy demand of nearl 30 kWh at freezing point

### Solar Generation Effectiveness

-   Analysis showed that the solar power generated is consistently less than that predicted during the month of September
-   ?? probably throughout the year but only have monthly
-   ?? but is this caused by inefficiency in the generation equipment or is it caused because the irradiance expereinced is less than that predicted? don't have annual irradiance and generation figures to determine this

### Solar Energy Sufficiency

- ?? looks like majority of demands are met
- ?? but a surprising statistical result

### ?????? further work

?? Increased battery will smooth out across days? forecast storage/impact .. but can't see the intra-day detail to better analyse
?? Predict full year / annual generation using non September ?? monthly irradiance data: <https://re.jrc.ec.europa.eu/pvg_tools/en/#MR>
?? box plots

##?? Discussion

*TO DO: Structure into two sections*

##?? Conclusion

Test citations [@Crawley2014] and as @spiegel2012

\newpage

# Appendices

### *?? Energy Consumption ....*

# References
